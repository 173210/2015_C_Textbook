<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="utf-8" />
    <title>C言語の文字列</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/sanitize.css/2.0.0/sanitize.min.css">
    <link rel="stylesheet" href="./css/style.css">
    <script src="./syntaxhighlighter/scripts/shCore.js" type="text/javascript"></script>
    <script src="./syntaxhighlighter/scripts/shBrushPlain.js" type="text/javascript"></script>
    <script src="./syntaxhighlighter/scripts/shBrushCpp_kai.js" type="text/javascript"></script>
    <link href="./syntaxhighlighter/styles/shCore.css" rel="stylesheet" type="text/css">
    <link href="./syntaxhighlighter/styles/shThemeMidnight_likeVS.css" rel="stylesheet" type="text/css">
    <script type="text/javascript">
        SyntaxHighlighter.all();
    </script>
</head>
<body>
    <h1>C言語の文字列</h1>
    <p>
        C言語には文字列という概念がありません。NULL文字で終わるバイト集合があるだけです。<br>
        ・・・と書いても何が何やらさっぱりだと思うので、順番に解説します。<br>
        配列についでの理解があやふやな場合、ポインターを矢印に例えて誰かに説明できそうにない場合は引き返してください。
    </p>
    <section>
        <h2>符号化文字集合と符号化方式</h2>
        <p>まずここが理解できないとすべてが宙ぶらりんでその場しのぎの理解になってしまいます。なのでプログラミングから一旦離れて解説しようと思います。</p>
        <!--http://equj65.net/tech/charcode/-->
        <p>まず、以下のキーワードを覚えてください。</p>
        <dl>
            <dt>文字</dt>
            <dd>私たちが普段見ている文字。その形そのもの</dd>
            <dt>符号点</dt>
            <dd>符号点は文字を割り当て「うる」点のことである、ようは文字に仮想的に数値（普通非負の整数）を割り当てた（文字を座標空間に対応付けた）ものである。</dd>
            <dt>バイト列</dt>
            <dd>実際にPC等であつかう数値の羅列。符号点と一致することもある</dd>
        </dl>
        <p>覚えたかな？もうちょっとだけ続くんじゃ。</p>
        <dl>
            <dt>符号化文字集合</dt>
            <dd>文字と符号点を対応付けるもの</dd>
            <dt>符号化方式</dt>
            <dd>符号点とバイト列を対応付けるもの</dd>
        </dl>
        <p>
            で、すべての文字の表し方がこれに従っているかというと、そうでもありません。もう一度いいます、必ずしも符号化文字集合と符号化方式の2つがあるわけではありません。<br>
            しかも、上の「符号化文字集合」と「符号化方式」の説明も必ずしも正しくありません。というのはいろんな規格でいろいろ言っていたり、定義があやふやだったりするからです。
            じゃあ今までの話は意味がなかったのか？というとそんなことはありません。
        </p>
        <blockquote>
            <p>
                シフトJISが符号化文字集合? - yanok.net<br>
                <a href="http://yanok.net/2011/08/jis-2.html">http://yanok.net/2011/08/jis-2.html</a>
            </p>
            <p>
                肝心なことは、「符号化文字集合と文字符号化方式」という区分は絶対的・本質的なものでは必ずしもないということです。そういう区分を設けた方が便利なときだけ、採用すればいいわけです。
            </p>
        </blockquote>
        <p>ということです。まあ、抽象的な話ばっかしていても仕方ないので実例を上げましょう</p>
        <dl>
            <dt>符号化文字集合</dt>
            <dd>JIS X 0208, JIS X 0213, Unicodeなど・・・</dd>
            <dt>符号化方式</dt>
            <dd>Shift-JIS, EUC, UTF-8, UTF-16, UTF-32など・・・</dd>
            <dt>そんな区分ねーから</dt>
            <dd>ASCII, Latin-1, Big5など・・</dd>
        </dl>
        <p>
            みんなテキストエディタの保存の設定でよく見たことが有りますよね？<br>
            最初に言ったようにShift-JISとかUTF-16やUTF-32だけ覚えてくれてればとりあえずいいです。
        </p>
    </section>
    <section>
        <h2>C/C++言語では文字をどう扱うか</h2>
        <p>でこれら文字符号化形式をC/C++でどう扱うかですが、実はいまだにごたついています(VCのせい)。あれれ～。</p>
        <dl>
            <dt>char型</dt>
            <dd>実装定義ですが、char型が1byteなので普通Shift-JISかUTF-8を入れます。</dd>
            <dt>wchar_t型</dt>
            <dd>
                これまた実装定義ですが、Unicodeには違いないです。今のところVCではUTF-16, mingw-gccではUTF-32のようです。<br>
                どちらになるかはマクロ__STDC_UTF_16__、__STDC_UTF_32__が1になってるのがどちらか、で分かります。
            </dd>
            <dt>char16_t型(C11/C++11 or later)</dt>
            <dd>UTF-16になります</dd>
            <dt>char32_t型(C11/C++11 or later)</dt>
            <dd>UTF-32になります</dd>
        </dl>
        <p>で、毎度のことですが、VCは規格を準拠する気がないので、さっぱり実装が進みませんでした。2015年夏に正式release予定のVisual Studio 2015でようやっと実装されます(Preview版でも実装されている)。遅っそいわ！</p>
    </section>
    <section>
        <h2>文字リテラル(Character literals)</h2>
        <p>整数リテラルや小数リテラルがあるんだから、当然文字リテラルも有ります。が、これまた揉めたんだ。</p>
        <pre class="brush: cpp;">/* 以前からある記法 */
// 型はchar、値は実装依存。
auto ordinary_c = 'x' ;
// 型はwchar_t、値は実装依存。
auto wide_c = L'x' ;

/* C11/C++11 以降で追加されている記法 */
// 型はchar16_t、符号化方式はUTF-16、値は、0x3042。
auto u16_c = u'あ' ;
// 型はchar32_t、符号化方式はUTF-32、値は、0x00003042。
auto u32_c = U'あ' ;

/* C++17以降の記法 */
//型はchar、符号化方式はUTF-8、 値はOx78
auto u8_c = u8'x';</pre>
        <p>LとかuとかUとかu8とかをprefixといいます。</p>
        <p>u8-prefixをつけるときは必ずその文字がsingle UTF-8 code unit、つまり8bitに収まる必要があります。ようは</p>
        <pre class="brush: cpp;">auto u8_c = u8'あ';//ill-formed</pre>
        <p>はダメです。同様にu-prefixをつけるときは必ずその文字が16bitに収まる必要があります。ようは</p>
        <pre class="brush: cpp;">autp u16_c = u16'𠮷';//ill-formed</pre>
        <p>
            はダメです。なおこのように文字型に収まりきらない文字は2つで一つだったり3つで１つの文字を表すわけですが(文字列リテラルを参照)、こういうのをサロゲートペアといいます。<br>
            今のところ、UTF-32なら32bitですべての世界中の文字を表せる、ということになっています。
        </p>
        <p>
            で、なぜかu8のCharacter literalsのprefixとしての機能だけつまはじきにあってC++17に追いやられています(<a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2014/n4296.pdf">n4296</a>)<br>
            uとUはC11/C++11で採用されました(<a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2012/n3337.pdf">n3337</a>,<a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2013/n3797.pdf">n3797</a> )。<br>
            でVisualStudioはuとUにVisualStudio2015でようやく対応しました。u8は・・・・？
        </p>
    </section>
    <section>
        <h2>エスケープシーケンス</h2>
        <p>いくつかの特殊な文字を表すために、\(バックスラッシュ)から始まるエスケープシーケンスが存在します。なお\(バックスラッシュ)自体が表せなくなるため、それ自体のエスケープもあります。</p>
        <table>
            <tr><th>エスケープシーケンス</th><th>文字名(日本語)</th><th>文字名(英語)</th><th>文字</th></tr>
            <tr><td>\n</td><td>改行</td><td>new-line</td><td>NL(LF)</td></tr>
            <tr><td>\t</td><td>水平タブ</td><td>horizontal tab</td><td>HT</td></tr>
            <tr><td>\v</td><td>垂直タブ</td><td>vertical tab</td><td>VT</td></tr>
            <tr><td>\b</td><td>バックスペース</td><td>backspace</td><td>BS</td></tr>
            <tr><td>\r</td><td>キャリッジリターン</td><td>carriage return</td><td>CR</td></tr>
            <tr><td>\f</td><td>フォームフィード</td><td>form feed</td><td>FF</td></tr>
            <tr><td>\a</td><td>アラート文字、ベル文字</td><td>alert</td><td>BEL</td></tr>
            <tr><td>\\</td><td>バックスラッシュ</td><td>backslash</td><td>\</td></tr>
            <tr><td>\?</td><td>疑問符</td><td>question mark</td><td>?</td></tr>
            <tr><td>\'</td><td>単一引用符</td><td>single quote</td><td>'</td></tr>
            <tr><td>\"</td><td>二重引用符</td><td>double quote</td><td>"</td></tr>
        </table>
        <pre class="brush: cpp;">'\n';//OK
'\\';//OK
'\"';//OK
'"';//OK
'\?';//OK
'?';//OK
'\';//エラー</pre>
    </section>
    <section>
        <h2>文字列リテラル</h2>
        <p>整数リテラルや小数リテラルがあるんだから、当然文字列リテラルもあります。</p>
        <!--http://ezoeryou.github.io/cpp-book/C++11-Syntax-and-Feature.xhtml#lex.string-->
    </section>
</body>
</html>
